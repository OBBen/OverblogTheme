<!DOCTYPE html>
<html lang="{{ Blog.Lang|default('en') }}">
    <head>
        <!-- shortcut:[Meta] -->
        <!-- title, description, keyword, robots -->
        {% if isSingle%}
            {% list Posts %}
                <title>{% if Post.Title is not empty %}{{ Post.Title }} - {% elseif Post.Snippet is not empty %}{{ Post.Snippet|truncate(80) }} - {% endif %}{{Blog.Title}}</title>
                <meta name="description" content="{{ Post.Snippet }}" />
                <meta name="keywords" content="{% list Post.Tags %}{{ Tag.Title }}{% if loop.last == false %}, {% endif %}{% endlist %}" />
                <meta name="robots" content="index,follow" />
            {% endlist %}
        {% elseif isTag and Tag is not empty %}
            <title>{{ Tag.Title|title }} - {{ Blog.Title }}</title>
            <meta name="description" content="{{ Blog.Description }}" />
            <meta name="keywords" content="{{ Tag.Title|title }}" />
            <meta name="robots" content="index,follow" />
        {% elseif isSearch and Search is not empty %}
            <title>{{ Search|title }} - {{ Blog.Title }}</title>
            <meta name="description" content="{{ Blog.Description }}" />
            <meta name="keywords" content="{{ Search|title }}" />
            <meta name="robots" content="noindex" />
        {% else %}
            <title>{{Blog.Title}}</title>
            <meta name="description" content="{{ Blog.Description }}" />
            <meta name="robots" content="index,follow" />
        {% endif %}
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />


        <!-- Social setting : Facebook, G+ .. -->
        <meta property="og:site_name" content="{{ Blog.Title }}" />
        <meta property="og:type" content="blog" />
        <meta property="fb:app_id" content="{% if Custom('facebook_appid') is not empty %}{{ Custom('facebook_appid') }}{% endif %}" />
        {% if Custom('facebook_username') is not empty %}
            <meta property="fb:admins" content="{{ Custom('facebook_username') }}"/>
        {% endif %}
        <meta itemprop="name" content="{{ Blog.Title }}" />

        {% if isSingle %}
            {% list Posts %}
                <meta property="og:title" content="{% if Post.Title is not empty %}{{ Post.Title }} - {% elseif Post.Snippet is not empty %}{{ Post.Snippet|truncate(80) }}{% endif %}"/>
                <meta property="og:description" content="{{ Post.Snippet }}" />
                <meta itemprop="description" content="{{ Post.Snippet }}" />
                <meta property="og:url" content="{{ Blog.Url }}{{ Post.Permalink }}" />
                {% if Post.Cover %}
                    <meta property="og:image" content="{{ Post.Cover }}"/>
                    <meta itemprop="image" content="{{ Post.Cover }}" />
                {% endif %}
            {% endlist %}
            <meta property="og:type" content="overblogkiwi:see" />
        {% else %}
            <meta property="og:title" content="{{ Blog.Title }}"/>
            <meta property="og:description" content="{{ Blog.Description }}" />
            <meta itemprop="description" content="{{ Blog.Description }}" />
            {% if Blog.Avatar %}
                <meta property="og:image" content="{{ Blog.Avatar }}"/>
                <meta itemprop="image" content="{{ Blog.Avatar }}" />
            {% else %}
                {% list Posts %}
                    {% if loop.index == 1 and Post.Cover %}
                        <meta property="og:image" content="{{ Post.Cover }}"/>
                        <meta itemprop="image" content="{{ Post.Cover }}" />
                    {% endif %}
                {% endlist %}
            {% endif %}

            {% if isSearch %}
                <meta property="og:type" content="overblogkiwi:search" />
            {% else %}
                <meta property="og:type" content="overblogkiwi:visit" />
            {% endif %}
        {% endif %}
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <link type="text/css" rel="stylesheet" href="http://assets.over-blog-kiwi.com/themes/jquery/fancybox/jquery.fancybox-1.3.4.css" media="screen" />
        <style type="text/css">
            #global {
                background: #EEE; 
                margin: 50px auto;
                max-width: 1100px; 
            }

            .main {
                padding: 30px;
            }
            .item {
                background-color: #DDD;
                float: left;
                margin: 10px;
                padding: 10px;
                width: 220px;
            }
            .single .item {
                margin: 10px;
                padding: 10px;
                width: 600px;
            }
            .single .about {
                float: left;
                max-width: 220px;
            }
            .about {
                background-color: #333;
            }
            .item img {width: 100%;}

            /* reset tweet */
            blockquote.ob-tweet {
                background: none;
                border: none;
                -webkit-border-radius: 0;
                   -moz-border-radius: 0;
                    -ms-border-radius: 0;
                     -o-border-radius: 0;
                        border-radius: 0;
                -webkit-box-shadow: none;
                   -moz-box-shadow: none;
                    -ms-box-shadow: none;
                     -o-box-shadow: none;
                        box-shadow: none;
                font-family: 'Helvetica Neue',Arial,sans-serif;
                padding: 0;
            }

            .twitter-tweet img,
            blockquote.ob-tweet .ob-media-left {
                -webkit-border-radius: 0;
                   -moz-border-radius: 0;
                    -ms-border-radius: 0;
                     -o-border-radius: 0;
                        border-radius: 0;
                        height: auto;
                        min-height: 0;
                        width: auto;
            }

            /* loader */
            .ias_loader {
                background: #CCC;
                border-radius: 5px;
                bottom: 50px; 
                left: 50%;
                padding: 15px;
                position: absolute; 
            }
            .ias_loader img {
                width: 60px;
            }
        </style>
    </head>
    <body>
        <!-- global -->
        <div id="global">            
            <!-- header -->
            <header>
                <h1>
                    <a href="{{ Blog.Url }}" title="{{ Blog.Description }}">{{ Blog.Title }}</a>
                </h1>
                <form method="" action="">
                    <input type="search" placeholder="{{ Lang.Get('Search') }}" name="" />
                    <input type="submit" value="{{ Lang.Get('Search on the blog') }}" />
                </form>
            </header>

            <!-- main -->
            <section class="main{% if isSpecial %} special{% else %} posts{% endif %}{% if isSingle %} single{% else %} index{% endif %}">
                {% if isSpecial %}
                    <article>
                        {{ SpecialContent }}
                    </article>
                {% else %}
                    {% if not isSingle %}
                        <div class="item">
                            <article class="widget">
                                {% if Blog.Owner.Avatar is not empty %}
                                    <a class="avatar" href="{{ Blog.Owner.Avatar }}" {% if Blog.Owner.Nickname is not empty %}title="{{ Blog.Owner.Nickname }}"{% endif %}>
                                        <img src="{{ Blog.Owner.Avatar|resize(220,320)|crop }}" alt="" title="" width="220px" height="302px" />
                                    </a>
                                {% endif %}
                                {% if Blog.Owner.Nickname is not empty %}
                                    <h4>{{ Blog.Owner.Nickname }}</h4>
                                {% endif %}
                                {% if Blog.Owner.Bio is not empty %}
                                    <p>{{ Blog.Owner.Bio }}</p>
                                {% endif %}
                                <a href="/contact">{{ Lang.Get('Contact me') }}</a>
                            </article>
                            <article class="widget">
                                <h3>{{ Lang.Get('Follow me') }}</h3>
                            </article>
                        </div>
                    {% endif %}
                    {% list Posts %}
                        <article class="item">
                            <header>
                                <time pubdate="{{ Post.Date }}">{{ Post.Date|datel(Lang.Get('Default date format'))|title }}</time>
                                
                                <a class="permalink" href="{{ Post.Cover }}" {% if Post.Snippet is not empty %}title="{{ Post.Snippet }}"{% endif %}>
                                    <h2>
                                        {% if Post.Title is not empty %}
                                            {{ Post.Title }}
                                        {% else %}
                                            {{ Lang.Get('Published from') }}
                                            {% list Post.Sources %}
                                                {{ Lang.Get(Source) }} {% if not loop.last %}{{ Lang.Get('and') }} {% endif %}
                                            {% endlist %}
                                        {% endif %}
                                    </h2>
                                </a>
                            </header>
                            {% if isSingle %}
                                {{ Post.Body }}
                            {% else %}
                                {% if Post.Cover is not empty %}
                                    <a class="permalink" href="{{ Blog.Url }}{{ Post.Permalink }}" {% if Post.Snippet is not empty %}title="{{ Post.Snippet }}"{% endif %}>
                                        <img src="{{ Post.Cover }}" alt="" title="" width="" />
                                    </a>
                                {% endif %}
                                
                                {% list Post.Sources %}
                                    {% if loop.first and Source == 'TW' %}
                                        {{ Post.Body(1) }}
                                        <p><a class="tweet-reply" href="">Reply</a></p>
                                        <p><a class="tweet-retweet" href="">Retweet</a></p>
                                        <p><a class="tweet-favorite" href="">Favorite</a>
                                    {% elseif Post.Snippet is not empty %}
                                        <p>{{ Post.Snippet }}</p>
                                    {% endif %}
                                {% endlist %}
                            {% endif %}

                            <!-- comments -->
                            {% if not isPage and Post.ShowComments is not empty %}
                                <div class="item-comments" id="comments">
                                    {% if Custom("comment") == "Facebook" %}
                                        <div class="fb-comments" data-href="{{ Post.Permalink }}" data-num-posts="2" data-width="600" data-colorscheme="{{ Custom('facebook_comments_color') }}"></div>
                                    {% elseif Custom("comment") == "Disqus" and Custom('comment_disqus') is not empty %}
                                        <div id="disqus_thread"></div>
                                        <script type="text/javascript">
                                            var disqus_shortname = '{{ Custom('comment_disqus') }}';

                                            (function() {
                                                var dsq = document.createElement('script');
                                                    dsq.type = 'text/javascript';
                                                    dsq.async = true;
                                                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                                                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                                            })();
                                        </script>
                                        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                                    {% else %}
                                        <h6>{{ Lang.Get('Comment this post') }}</h6>
                                        {{ Post.Comments }}
                                    {% endif %}
                                </div>
                            {% endif %}
                            {% list Post.Sources %}
                                {% if loop.first and Source != 'TW' %}
                                    {% list Post.Tags %}
                                        {% if loop.first %}Tag(s) {% endif %}
                                        <a href="{{ Tag.url }}">{{ Tag.Title }}</a>{% if loop.last is empty %}, {% endif %}
                                    {% endlist %}
                                {% endif %}
                            {% endlist %}

                            <footer>
                                {% if not isSingle %}
                                    <div class="share">
                                        <a href="https://plus.google.com/share?url={ {{ Blog.Url }}{{ Post.Permalink }} }">Share on Google+</a>
                                        <a href="https://twitter.com/share?url={{ Blog.Url }}{{ Post.Permalink }}&text={% if Post.Title is not empty %}{{ Post.Title }}{% elseif Post.Snippet is not empty %}{{ Post.Snippet}}{% else %}{{ Blog.Title }}{% endif %}&via=Vivien&" target="_blank">
                                            Share on twitter</a>

                                        <a href="https://www.facebook.com/sharer/sharer.php?u={{ Blog.Url }}{{ Post.Permalink }}&t={% if Post.Title is not empty %}{{ Post.Title }}{% elseif Post.Snippet is not empty %}{{ Post.Snippet}}{% else %}{{ Blog.Title }}{% endif %}" target="_blank">Share on Facebook</a>
                                    </div>
                                {% endif %}
                            </footer>
                        </article>
                    {% else %}
                        <p>{{ Lang.Get('No post found') }}.</p>
                    {% endlist %}
                {% endif %}

                <nav class="load-more">
                    <a href="{{ Navigation.NextPage }}"></a>
                </nav>
            </section>
            {% if not isSingle and not isSpecial %}
                <a href="#global">{{ Lang.Get('Scroll to top') }}</a>
            {% endif %}
        </div>

        <!-- Scripts -->
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
        <script src="http://masonry.desandro.com/jquery.masonry.min.js"></script>
        <script src="http://assets.over-blog-kiwi.com/themes/jquery/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
        <script src="http://assets.over-blog-kiwi.com/themes/jquery/infinite-ajax-scroll/jquery.ias.min.js"></script>

        <script>

            // Twitter controls
            var TwitterControls = function (elements){
                $(elements).find(".ob-tweet").each(function(){
                    var $datatwitter = $(this).find("a[data-twitter]").attr("data-twitter");

                    $(this).parent().parent().find(".tweet-reply").attr("href", "https://twitter.com/intent/tweet?in_reply_to=" + $datatwitter);
                    $(this).parent().parent().find(".tweet-retweet").attr("href", "https://twitter.com/intent/retweet?tweet_id=" + $datatwitter);
                    $(this).parent().parent().find(".tweet-favorite").attr("href", "https://twitter.com/intent/favorite?tweet_id=" + $datatwitter);
                });
            }

            var SocialPopup = function() {
                $(".tweet-reply, .tweet-retweet, .tweet-favorite, .share a").click(function() {
                    var $popup = window.open($(this).prop("href"), '',"width=650, height=325, scrollbars=0, left=" +((screen.width - 650)/2) + ", top=" + ((screen.height - 325)/2) );
                    if (window.focus){
                        $popup.focus();
                    }
                    return false;
                });
            }

            $(document).ready(function(){                 
                TwitterControls($(".item"));

                SocialPopup();
                
                // Masonry
                var $container;
                $container = $(".posts");
                
                $container.imagesLoaded(function(){
                    $container.masonry({
                        itemSelector : ".item",
                        columnWidth : 20,
                        isAnimated: true,
                        isAnimatedFromBottom: true
                    });
                });

                // Fancybox
                $(".permalink").fancybox({
                    "autoScale"         :  false,
                    // "autoDimensions"     : false,
                    "height"            :  "auto",
                    "margin"            :  0,
                    "overlayOpacity"    :  0.9,
                    "overlayShow"       :  true,
                    "overlayColor"      :  "#FFF",
                    "padding"           :  10,  
                    "scrolling"         :  "no",
                    "scrollOutside"     :  false,
                    "showCloseButton"   :  false,
                    "titleShow"         :  false,
                    "transitionIn"      :  "elastic", 
                    "transitionOut"     :  "elastic",
                    "width"             :  650                
                });
                
                // Load more with Masonry 
                jQuery.ias({
                    container      : ".posts",
                    item           : ".item",
                    pagination     : ".load-more",
                    next           : ".load-more a",
                    loader         : "<img src='http://assets.over-blog-kiwi.com/themes/14/images/ajax_loader.gif' alt='' title='' />",
                    history        : false,
                    tresholdMargin : -500,
                    onLoadItems    : function(items) {
                        var $newElems; 
                        
                        items.shift();
                        
                        $newElems = $(items);
                        $newElems.css({ opacity: 0 });
                        
                        $newElems.imagesLoaded(function(){
                            $newElems.animate({ opacity: 1 });
                            $container.masonry( "appended", $newElems, true );
                        });

                        TwitterControls(items);
                    },
                    onRenderComplete : function() {
                        $(".permalink").fancybox({
                            "autoScale"         :  false,
                            // "autoDimensions"     : false,
                            "height"            :  "auto",
                            "margin"            :  0,
                            "overlayOpacity"    :  0.9,
                            // "overlayShow"       :  true,
                            "overlayColor"      :  "#FFF",
                            "padding"           :  10,  
                            "scrolling"         :  "no",
                            "scrollOutside"     :  false,
                            "showCloseButton"   :  false,
                            "titleShow"         :  false,
                            "transitionIn"      :  "elastic", 
                            "transitionOut"     :  "elastic",
                            "width"             :  650                
                        });
                    }
                });
            });
        </script>
    </body>
</html>